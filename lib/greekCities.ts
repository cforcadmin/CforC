/**
 * Comprehensive mapping of Greek cities/towns to their Περιφέρεια (Region).
 * Values are arrays to handle the rare case of a name existing in multiple regions.
 */
export const CITY_TO_PROVINCE: Record<string, string[]> = {
  // ── Αττική ──
  "Αθήνα": ["Αττική"],
  "Πειραιάς": ["Αττική"],
  "Περιστέρι": ["Αττική"],
  "Καλλιθέα": ["Αττική"],
  "Νίκαια": ["Αττική"],
  "Γλυφάδα": ["Αττική"],
  "Αιγάλεω": ["Αττική"],
  "Νέα Σμύρνη": ["Αττική"],
  "Ίλιον": ["Αττική"],
  "Αγία Παρασκευή": ["Αττική"],
  "Χαλάνδρι": ["Αττική"],
  "Μαρούσι": ["Αττική"],
  "Κηφισιά": ["Αττική"],
  "Ηλιούπολη": ["Αττική"],
  "Αργυρούπολη": ["Αττική"],
  "Βούλα": ["Αττική"],
  "Βουλιαγμένη": ["Αττική"],
  "Ραφήνα": ["Αττική"],
  "Λαύριο": ["Αττική"],
  "Μέγαρα": ["Αττική"],
  "Ελευσίνα": ["Αττική"],
  "Σαλαμίνα": ["Αττική"],
  "Αίγινα": ["Αττική"],
  "Πόρος": ["Αττική"],
  "Ύδρα": ["Αττική"],
  "Σπέτσες": ["Αττική"],
  "Παλλήνη": ["Αττική"],
  "Γέρακας": ["Αττική"],
  "Κορωπί": ["Αττική"],
  "Βάρη": ["Αττική"],
  "Νέα Ιωνία": ["Αττική"],
  "Ηράκλειο Αττικής": ["Αττική"],
  "Μεταμόρφωση": ["Αττική"],
  "Λυκόβρυση": ["Αττική"],
  "Πεντέλη": ["Αττική"],
  "Παπάγου": ["Αττική"],
  "Χολαργός": ["Αττική"],
  "Βριλήσσια": ["Αττική"],
  "Φιλοθέη": ["Αττική"],
  "Ψυχικό": ["Αττική"],
  "Εκάλη": ["Αττική"],
  "Δάφνη": ["Αττική"],
  "Υμηττός": ["Αττική"],
  "Άλιμος": ["Αττική"],
  "Ελληνικό": ["Αττική"],
  "Αρτέμιδα": ["Αττική"],
  "Σπάτα": ["Αττική"],
  "Μαρκόπουλο": ["Αττική"],
  "Κερατσίνι": ["Αττική"],
  "Δραπετσώνα": ["Αττική"],
  "Μοσχάτο": ["Αττική"],
  "Ταύρος": ["Αττική"],
  "Κορυδαλλός": ["Αττική"],
  "Πετρούπολη": ["Αττική"],
  "Άνω Λιόσια": ["Αττική"],
  "Ζεφύρι": ["Αττική"],
  "Αχαρνές": ["Αττική"],
  "Θρακομακεδόνες": ["Αττική"],
  "Διόνυσος": ["Αττική"],
  "Ανάβυσσος": ["Αττική"],
  "Κερατέα": ["Αττική"],

  // ── Κεντρική Μακεδονία ──
  "Θεσσαλονίκη": ["Κεντρική Μακεδονία"],
  "Καλαμαριά": ["Κεντρική Μακεδονία"],
  "Σέρρες": ["Κεντρική Μακεδονία"],
  "Κατερίνη": ["Κεντρική Μακεδονία"],
  "Βέροια": ["Κεντρική Μακεδονία"],
  "Νάουσα": ["Κεντρική Μακεδονία"],
  "Έδεσσα": ["Κεντρική Μακεδονία"],
  "Γιαννιτσά": ["Κεντρική Μακεδονία"],
  "Κιλκίς": ["Κεντρική Μακεδονία"],
  "Πολύγυρος": ["Κεντρική Μακεδονία"],
  "Χαλκιδική": ["Κεντρική Μακεδονία"],
  "Νέα Μουδανιά": ["Κεντρική Μακεδονία"],
  "Κασσάνδρα": ["Κεντρική Μακεδονία"],
  "Λιτόχωρο": ["Κεντρική Μακεδονία"],
  "Αλεξάνδρεια": ["Κεντρική Μακεδονία"],
  "Σκύδρα": ["Κεντρική Μακεδονία"],
  "Σταυρούπολη": ["Κεντρική Μακεδονία"],
  "Εύοσμος": ["Κεντρική Μακεδονία"],
  "Αμπελόκηποι": ["Κεντρική Μακεδονία"],
  "Πυλαία": ["Κεντρική Μακεδονία"],
  "Θέρμη": ["Κεντρική Μακεδονία"],
  "Ωραιόκαστρο": ["Κεντρική Μακεδονία"],
  "Περαία": ["Κεντρική Μακεδονία"],

  // ── Δυτική Μακεδονία ──
  "Κοζάνη": ["Δυτική Μακεδονία"],
  "Πτολεμαΐδα": ["Δυτική Μακεδονία"],
  "Φλώρινα": ["Δυτική Μακεδονία"],
  "Καστοριά": ["Δυτική Μακεδονία"],
  "Γρεβενά": ["Δυτική Μακεδονία"],
  "Σιάτιστα": ["Δυτική Μακεδονία"],
  "Αμύνταιο": ["Δυτική Μακεδονία"],

  // ── Ανατολική Μακεδονία και Θράκη ──
  "Καβάλα": ["Ανατολική Μακεδονία και Θράκη"],
  "Κομοτηνή": ["Ανατολική Μακεδονία και Θράκη"],
  "Ξάνθη": ["Ανατολική Μακεδονία και Θράκη"],
  "Αλεξανδρούπολη": ["Ανατολική Μακεδονία και Θράκη"],
  "Δράμα": ["Ανατολική Μακεδονία και Θράκη"],
  "Ορεστιάδα": ["Ανατολική Μακεδονία και Θράκη"],
  "Διδυμότειχο": ["Ανατολική Μακεδονία και Θράκη"],
  "Σουφλί": ["Ανατολική Μακεδονία και Θράκη"],
  "Θάσος": ["Ανατολική Μακεδονία και Θράκη"],
  "Χρυσούπολη": ["Ανατολική Μακεδονία και Θράκη"],
  "Ελευθερούπολη": ["Ανατολική Μακεδονία και Θράκη"],

  // ── Ήπειρος ──
  "Ιωάννινα": ["Ήπειρος"],
  "Άρτα": ["Ήπειρος"],
  "Πρέβεζα": ["Ήπειρος"],
  "Ηγουμενίτσα": ["Ήπειρος"],
  "Κόνιτσα": ["Ήπειρος"],
  "Μέτσοβο": ["Ήπειρος"],
  "Φιλιάτες": ["Ήπειρος"],
  "Πάργα": ["Ήπειρος"],

  // ── Θεσσαλία ──
  "Λάρισα": ["Θεσσαλία"],
  "Βόλος": ["Θεσσαλία"],
  "Τρίκαλα": ["Θεσσαλία"],
  "Καρδίτσα": ["Θεσσαλία"],
  "Νέα Ιωνία Βόλου": ["Θεσσαλία"],
  "Σκιάθος": ["Θεσσαλία"],
  "Σκόπελος": ["Θεσσαλία"],
  "Αλόννησος": ["Θεσσαλία"],
  "Ελασσόνα": ["Θεσσαλία"],
  "Τύρναβος": ["Θεσσαλία"],
  "Φάρσαλα": ["Θεσσαλία"],
  "Καλαμπάκα": ["Θεσσαλία"],
  "Παλαμάς": ["Θεσσαλία"],
  "Σοφάδες": ["Θεσσαλία"],
  "Αλμυρός": ["Θεσσαλία"],

  // ── Στερεά Ελλάδα ──
  "Λαμία": ["Στερεά Ελλάδα"],
  "Χαλκίδα": ["Στερεά Ελλάδα"],
  "Θήβα": ["Στερεά Ελλάδα"],
  "Λιβαδειά": ["Στερεά Ελλάδα"],
  "Άμφισσα": ["Στερεά Ελλάδα"],
  "Καρπενήσι": ["Στερεά Ελλάδα"],
  "Αράχωβα": ["Στερεά Ελλάδα"],
  "Δελφοί": ["Στερεά Ελλάδα"],
  "Ιτέα": ["Στερεά Ελλάδα"],
  "Γαλαξίδι": ["Στερεά Ελλάδα"],
  "Ερέτρια": ["Στερεά Ελλάδα"],
  "Αιδηψός": ["Στερεά Ελλάδα"],
  "Ιστιαία": ["Στερεά Ελλάδα"],
  "Κύμη": ["Στερεά Ελλάδα"],
  "Αταλάντη": ["Στερεά Ελλάδα"],
  "Στυλίδα": ["Στερεά Ελλάδα"],

  // ── Δυτική Ελλάδα ──
  "Πάτρα": ["Δυτική Ελλάδα"],
  "Αγρίνιο": ["Δυτική Ελλάδα"],
  "Μεσολόγγι": ["Δυτική Ελλάδα"],
  "Πύργος": ["Δυτική Ελλάδα"],
  "Αμαλιάδα": ["Δυτική Ελλάδα"],
  "Ναύπακτος": ["Δυτική Ελλάδα"],
  "Αίγιο": ["Δυτική Ελλάδα"],
  "Κάτω Αχαΐα": ["Δυτική Ελλάδα"],
  "Ολυμπία": ["Δυτική Ελλάδα"],
  "Κρέστενα": ["Δυτική Ελλάδα"],
  "Λεχαινά": ["Δυτική Ελλάδα"],

  // ── Πελοπόννησος ──
  "Τρίπολη": ["Πελοπόννησος"],
  "Καλαμάτα": ["Πελοπόννησος"],
  "Κόρινθος": ["Πελοπόννησος"],
  "Σπάρτη": ["Πελοπόννησος"],
  "Ναύπλιο": ["Πελοπόννησος"],
  "Άργος": ["Πελοπόννησος"],
  "Μεγαλόπολη": ["Πελοπόννησος"],
  "Γύθειο": ["Πελοπόννησος"],
  "Μονεμβασιά": ["Πελοπόννησος"],
  "Κιάτο": ["Πελοπόννησος"],
  "Ξυλόκαστρο": ["Πελοπόννησος"],
  "Λουτράκι": ["Πελοπόννησος"],
  "Νεμέα": ["Πελοπόννησος"],
  "Επίδαυρος": ["Πελοπόννησος"],
  "Μυστράς": ["Πελοπόννησος"],
  "Πύλος": ["Πελοπόννησος"],
  "Μεθώνη": ["Πελοπόννησος"],
  "Κυπαρισσία": ["Πελοπόννησος"],

  // ── Ιόνια Νησιά ──
  "Κέρκυρα": ["Ιόνια Νησιά"],
  "Λευκάδα": ["Ιόνια Νησιά"],
  "Αργοστόλι": ["Ιόνια Νησιά"],
  "Κεφαλονιά": ["Ιόνια Νησιά"],
  "Ζάκυνθος": ["Ιόνια Νησιά", "Δυτική Ελλάδα"],
  "Ιθάκη": ["Ιόνια Νησιά"],
  "Παξοί": ["Ιόνια Νησιά"],
  "Κύθηρα": ["Ιόνια Νησιά"],

  // ── Βόρειο Αιγαίο ──
  "Μυτιλήνη": ["Βόρειο Αιγαίο"],
  "Λέσβος": ["Βόρειο Αιγαίο"],
  "Χίος": ["Βόρειο Αιγαίο"],
  "Σάμος": ["Βόρειο Αιγαίο"],
  "Λήμνος": ["Βόρειο Αιγαίο"],
  "Μύρινα": ["Βόρειο Αιγαίο"],
  "Ικαρία": ["Βόρειο Αιγαίο"],
  "Άγιος Κήρυκος": ["Βόρειο Αιγαίο"],

  // ── Νότιο Αιγαίο ──
  "Ερμούπολη": ["Νότιο Αιγαίο"],
  "Σύρος": ["Νότιο Αιγαίο"],
  "Ρόδος": ["Νότιο Αιγαίο"],
  "Κως": ["Νότιο Αιγαίο"],
  "Μύκονος": ["Νότιο Αιγαίο"],
  "Σαντορίνη": ["Νότιο Αιγαίο"],
  "Θήρα": ["Νότιο Αιγαίο"],
  "Νάξος": ["Νότιο Αιγαίο"],
  "Πάρος": ["Νότιο Αιγαίο"],
  "Αντίπαρος": ["Νότιο Αιγαίο"],
  "Τήνος": ["Νότιο Αιγαίο"],
  "Άνδρος": ["Νότιο Αιγαίο"],
  "Μήλος": ["Νότιο Αιγαίο"],
  "Σίφνος": ["Νότιο Αιγαίο"],
  "Σέριφος": ["Νότιο Αιγαίο"],
  "Κύθνος": ["Νότιο Αιγαίο"],
  "Κέα": ["Νότιο Αιγαίο"],
  "Αμοργός": ["Νότιο Αιγαίο"],
  "Ίος": ["Νότιο Αιγαίο"],
  "Φολέγανδρος": ["Νότιο Αιγαίο"],
  "Σίκινος": ["Νότιο Αιγαίο"],
  "Πάτμος": ["Νότιο Αιγαίο"],
  "Λέρος": ["Νότιο Αιγαίο"],
  "Κάλυμνος": ["Νότιο Αιγαίο"],
  "Αστυπάλαια": ["Νότιο Αιγαίο"],
  "Κάρπαθος": ["Νότιο Αιγαίο"],
  "Κάσος": ["Νότιο Αιγαίο"],
  "Σύμη": ["Νότιο Αιγαίο"],
  "Τήλος": ["Νότιο Αιγαίο"],
  "Νίσυρος": ["Νότιο Αιγαίο"],

  // ── Κρήτη ──
  "Ηράκλειο": ["Κρήτη"],
  "Χανιά": ["Κρήτη"],
  "Ρέθυμνο": ["Κρήτη"],
  "Άγιος Νικόλαος": ["Κρήτη"],
  "Ιεράπετρα": ["Κρήτη"],
  "Σητεία": ["Κρήτη"],
  "Μοίρες": ["Κρήτη"],
  "Τυμπάκι": ["Κρήτη"],
  "Κίσσαμος": ["Κρήτη"],
  "Ανώγεια": ["Κρήτη"],
  "Αρκαλοχώρι": ["Κρήτη"],
  "Νεάπολη Κρήτης": ["Κρήτη"],
}

/**
 * Get all unique city names for autocomplete, sorted alphabetically in Greek.
 */
export function getAllCities(): string[] {
  return Object.keys(CITY_TO_PROVINCE).sort((a, b) => a.localeCompare(b, 'el'))
}

/**
 * Get the province(s) for a given city name.
 * Returns empty array if city is not found.
 */
export function getProvincesForCity(city: string): string[] {
  const trimmed = city.trim()
  return CITY_TO_PROVINCE[trimmed] || []
}

/**
 * Given a comma-separated string of cities, derive all unique provinces.
 */
export function deriveProvinces(citiesString: string): string {
  if (!citiesString || citiesString.trim() === '' || citiesString.trim() === '-') return ''

  const cities = citiesString.split(',').map(c => c.trim()).filter(c => c)
  const provinces = new Set<string>()

  for (const city of cities) {
    const cityProvinces = getProvincesForCity(city)
    cityProvinces.forEach(p => provinces.add(p))
  }

  return Array.from(provinces).join(', ')
}

/**
 * Normalize a string for accent-insensitive matching.
 */
export function normalizeGreek(text: string): string {
  return text
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .toLowerCase()
}

/**
 * Search cities matching a query (accent-insensitive).
 */
export function searchCities(query: string): string[] {
  if (!query || query.trim().length === 0) return []

  const normalizedQuery = normalizeGreek(query.trim())
  const allCities = getAllCities()

  return allCities.filter(city =>
    normalizeGreek(city).startsWith(normalizedQuery)
  )
}
